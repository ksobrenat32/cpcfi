name: Build Reference PDF

on:
  push:
    paths:
      - 'notes/Reference.tex'
      - 'template.cpp'
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build-pdf:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install LaTeX
      run: |
        sudo apt-get update
        sudo apt-get install -y texlive-xetex texlive-fonts-recommended texlive-plain-generic

    - name: Build PDF
      run: |
        cd notes
        xelatex Reference.tex
        xelatex Reference.tex
  
    - name: Generate release tag
      id: tag
      run: |
        echo "tag=release-$(date +'%Y%m%d%H%M%S')" >> $GITHUB_OUTPUT

    - name: Create Release
      uses: softprops/action-gh-release@v2
      with:
        files: notes/Reference.pdf
        tag_name: ${{ steps.tag.outputs.tag }}
        name: Reference PDF - Build ${{ github.run_number }}
        body: |
          Automatically generated PDF from competitive programming reference.
          
          Generated from commit: ${{ github.sha }}
        token: ${{ secrets.GITHUB_TOKEN }}
        