name: Build Notes PDF

on:
  push:
    paths:
      - 'notes/**'
    branches:
      - main
      - master
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build-pdf:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install Pandoc
      run: |
        sudo apt-get update
        sudo apt-get install -y pandoc texlive-xetex

    - name: Build PDF
      run: |
        cd notes
        bash build.sh
  

    - name: Generate release tag
      id: tag
      run: |
        echo "tag=release-$(date +'%Y%m%d%H%M%S')" >> $GITHUB_OUTPUT

    - name: Create Release
      uses: softprops/action-gh-release@v2
      with:
        files: notes/notes.pdf
        tag_name: ${{ steps.tag.outputs.tag }}
        name: Notes PDF - Build ${{ github.run_number }}
        body: |
          Automatically generated PDF from competitive programming notes.
          
          Generated from commit: ${{ github.sha }}
          Date: ${{ github.event.head_commit.timestamp }}
        token: ${{ secrets.GITHUB_TOKEN }}
        